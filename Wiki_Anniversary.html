<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Wiki Anniversary</title>
    <meta name="description" content="A tool to check a user's Wiki anniversary, contributions, and wish them well.">
    <meta name="keywords" content="Wiki, MediaWiki, anniversary, user, contributions, birthday">
    <meta name="author" content="Suyash Dwivedi">
    <link rel="canonical" href="https://suyashdwivedi.github.io/Wiki_Tools/Wiki_Anniversary.html">
    <meta property="og:title" content="Wiki Anniversary">
    <meta property="og:description" content="A tool to check a user's Wiki anniversary, contributions, and wish them well.">
    <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/5/53/Wiki_s_Lazy_Coders_logo_small_transparent.png">
    <meta property="og:url" content="https://suyashdwivedi.github.io/Wiki_Tools/Wiki_Anniversary.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Wiki Anniversary">
    <meta name="twitter:description" content="A tool to check a user's Wiki anniversary, contributions, and wish them well.">
    <meta name="twitter:image" content="https://upload.wikimedia.org/wikipedia/commons/5/53/Wiki_s_Lazy_Coders_logo_small_transparent.png">
    <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/5/53/Wiki_s_Lazy_Coders_logo_small_transparent.png">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f8f9fa; color: #343a40; text-align: center; overflow-x: hidden; }
        header { background-color: #007bff; color: white; padding: 1em; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; flex-direction: column; }
        header h1, header h3 { margin: 0; }
        header img { height: 75px; margin-right: 15px; }
        .columns { display: flex; width: 100%; flex-wrap: wrap; justify-content: center; }
        .column { flex: 1; padding: 10px; min-width: 200px; }
        main { max-width: 700px; margin: 20px auto; background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); animation: fadeIn 0.5s ease-in-out; }
        form { display: flex; flex-direction: column; align-items: center; }
        label { margin-bottom: 10px; color: #007bff; }
        input { padding: 10px; margin-bottom: 20px; width: 60%; box-sizing: border-box; border: 1px solid #ced4da; border-radius: 5px; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 5px; transition: 0.3s ease; }
        button:hover { background-color: #0056b3; }
        #wishAnniversaryButton { display: none; margin-top: 15px; }
        #userDetails { margin-top: 20px; animation: fadeIn 0.5s ease-in-out; display: flex; flex-wrap: wrap; text-align: center; justify-content: center; }
        #userDetails h2 { color: #007bff; text-align: center; margin-bottom: 10px; }
        img.user-image { border-radius: 50%; max-width: 200px; margin-bottom: 10px; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        .night-mode-button { position: absolute; top: 10px; right: 10px; background-color: #007bff; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        .night-mode { background-color: #121212; color: #f8f9fa; }
        .night-mode header { background-color: #1f1f1f; }
        .night-mode main { background-color: #2c2c2c; color: #f8f9fa; }
        .night-mode label { color: #8ab4f8; }
        .night-mode input { background-color: #3e3e3e; color: #f8f9fa; border: 1px solid #555; }
        .night-mode button { background-color: #8ab4f8; color: black; }
        .night-mode h2 { color: #8ab4f8; }
        .night-mode a { color: #8ab4f8; }
        footer { margin-top: 20px; padding: 10px; font-size: 0.9em; color: #6c757d; }
        .copied-message {
            color: green;
            font-weight: bold;
            margin-left: 10px;
            animation: fadeOut 2s forwards;
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        #messagePreview {
            margin-top: 30px;
            padding: 20px;
            background-color: #e9ecef;
            border-left: 5px solid #007bff;
            text-align: left;
            white-space: pre-wrap;
            overflow-x: auto;
            max-width: 100%;
            box-sizing: border-box;
            display: none;
        }
        .night-mode #messagePreview {
            background-color: #3e3e3e;
            border-left: 5px solid #8ab4f8;
            color: #f8f9fa;
        }
        #addToCalendarButton {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.3s ease;
            margin-left: 10px;
        }
        #addToCalendarButton:hover {
            background-color: #218838;
        }
        .night-mode #addToCalendarButton {
            background-color: #2e8b57;
        }
        .night-mode #addToCalendarButton:hover {
            background-color: #267349;
        }
        .scroll-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }
        .scroll-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        .scroll-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Wiki_s_Lazy_Coders_logo_small_transparent.png" alt="Wiki's Lazy Coders Logo" style="height: 75px; float: left; margin-right: 15px;">
    <div>
        <h1>Wish Wiki Anniversary</h1>
        <h3>(As per SUL)</h3>
    </div>
	<p id="inspiration"> <i>I am amazed and inspired by how Wikimedians dedicate their volunteer time to strengthen and sustain this open-source movement. This is my small effort to acknowledge their contributions, bring a smile to their faces, and make them feel truly appreciated. - <a href="https://meta.wikimedia.org/wiki/User:Suyash.dwivedi" target="_blank" style="color: inherit; text-decoration: underline;">Suyash Dwivedi</a></i> </p>
</header>

<button class="night-mode-button" onclick="toggleNightMode()">Night Mode</button>

<main>
    <div id="usernameInput">
        <form id="userForm">
            <label for="username">Enter Username:</label>
            <input type="text" id="username" placeholder="Wiki Username" required onkeypress="handleKeyPress(event)">
            <button type="button" onclick="getUserDetails()">Get User Details</button>
        </form>
    </div>
    <div id="usernameHeader"></div>
    <div id="userDetails" class="columns"></div>
    <div style="display: flex; justify-content: center; align-items: center;">
        <button id="wishAnniversaryButton" onclick="handleWishAnniversary()">Wish Anniversary (Message Copied & Talk Page Opens)</button>
        <span id="copiedConfirmation" class="copied-message" style="display: none;">Copied!</span>
    </div>
    <button id="addToCalendarButton" onclick="addToCalendar()" style="display: none; margin-top: 10px;">
        Add Reminder to Google Calendar</button>
    <div id="daysToAnniversary"></div>
    <div id="messagePreview">
        <h3>How Your Message Will Look (Wikitext Format)</h3>
        <pre id="messageText"></pre>
    </div>
</main>

<footer>
    Created by <a href="https://meta.wikimedia.org/wiki/User:Suyash.dwivedi" target="_blank">Suyash Dwivedi</a> | Updated on: 08 October 2025<br>
    Idea from <a href="https://gnoeee.github.io/Wiki-Anniversary/" target="_blank">Wiki Anniversary</a>
</footer>

<div class="scroll-buttons">
    <button class="scroll-button" onclick="goToTop()">⬆</button>
    <button class="scroll-button" onclick="goToBottom()">⬇</button>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GC8PGC89NB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GC8PGC89NB');
</script>
<script src="https://cdn.counter.dev/script.js"
    data-id="cc7a036d-a904-4d76-bcac-37ea4196c014"
    data-utcoffset="6">
</script>
<script>
let homewikiUrl = "";
let storedUser = null;

const usernameFromURL = new URLSearchParams(window.location.search).get('username');
if(usernameFromURL){
    document.getElementById('username').value = usernameFromURL;
    getUserDetails();
}

async function getUserDetails(){
    const username = document.getElementById('username').value;
    const encodedUsername = encodeURIComponent(username);
    try{
        const response = await fetch(`https://www.mediawiki.org/w/api.php?action=query&format=json&meta=globaluserinfo&utf8=1&formatversion=2&guiuser=${encodedUsername}&guiprop=editcount|rights|merged|groups|unattached&origin=*`);
        const data = await response.json();
        storedUser = data.query.globaluserinfo;
        if (storedUser) {
            displayUserDetails(storedUser);
            displayDaysAndYears(storedUser.registration);
            showButtons();
            displayMessagePreview();
        } else {
            document.getElementById('usernameHeader').innerHTML = `<h2 style="color:red;">User not found or API error.</h2>`;
            document.getElementById('userDetails').innerHTML = "";
            document.getElementById('daysToAnniversary').innerHTML = "";
            document.getElementById('wishAnniversaryButton').style.display = 'none';
            document.getElementById('addToCalendarButton').style.display = 'none';
            document.getElementById('messagePreview').style.display = 'none';
        }
    }catch(e){
        console.error(e);
        document.getElementById('usernameHeader').innerHTML = `<h2 style="color:red;">User not found or API error.</h2>`;
        document.getElementById('userDetails').innerHTML = "";
        document.getElementById('daysToAnniversary').innerHTML = "";
        document.getElementById('wishAnniversaryButton').style.display = 'none';
        document.getElementById('addToCalendarButton').style.display = 'none';
        document.getElementById('messagePreview').style.display = 'none';
    }
}

async function displayUserDetails(user){
    const div = document.getElementById('userDetails');
    const headerDiv = document.getElementById('usernameHeader');
    div.innerHTML = ""; headerDiv.innerHTML = "";
    headerDiv.innerHTML = `<h2>${user.name}</h2>`;

    const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };

    const leftCol = document.createElement('div'); leftCol.classList.add('column');
    leftCol.innerHTML = `<p><strong>Registration Date:</strong></p><p>${new Date(user.registration).toLocaleDateString('en-US', dateOptions)}</p>
                            <p><strong>Total Edit Count:</strong></p><p>${user.editcount}</p>`;
    
    const rightCol = document.createElement('div'); rightCol.classList.add('column');
    try{
        homewikiUrl = await fetchHomewikiUrl(user.home, user.merged);
        rightCol.innerHTML = `<p><strong>Home Wiki:</strong></p><p><a href="${homewikiUrl}" target="_blank">${user.home}</a></p>
                                        <p><strong>ID:</strong></p><p>${user.id}</p>`;
    }catch(e){
        console.error(e); rightCol.innerHTML = `<p><strong>Home Wiki:</strong></p><p>Not available</p><p>ID: ${user.id}</p>`;
    }
    
    div.appendChild(leftCol);
    div.appendChild(rightCol);

    const globalTableDiv = document.createElement('div');
    globalTableDiv.style.cssText = "width: 100%; text-align: left; margin-top: 20px;";
    globalTableDiv.innerHTML = `
        <table style="width: 100%; border-collapse: collapse;">
            <tbody>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Global Groups:</td>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Global Rights:</td>
                </tr>
                <tr>
                    <td id="globalGroups" style="padding: 8px; border: 1px solid #ddd;">${user.groups && user.groups.length > 0 ? user.groups.join(', ') : 'None'}</td>
                    <td id="globalRights" style="padding: 8px; border: 1px solid #ddd;">${user.rights && user.rights.length > 0 ? user.rights.join(', ') : 'None'}</td>
                </tr>
            </tbody>
        </table>
    `;
    div.appendChild(globalTableDiv);

    const localTableDiv = document.createElement('div');
    localTableDiv.style.cssText = "width: 100%; text-align: left; margin-top: 20px;";
    localTableDiv.innerHTML = `
        <table style="width: 100%; border-collapse: collapse;">
            <tbody>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Local Groups:</td>
                    <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Local Rights:</td>
                </tr>
                <tr>
                    <td id="localGroups" style="padding: 8px; border: 1px solid #ddd;">Fetching...</td>
                    <td id="localRights" style="padding: 8px; border: 1px solid #ddd;">Fetching...</td>
                </tr>
            </tbody>
        </table>
    `;
    div.appendChild(localTableDiv);
    
    if(user.home && homewikiUrl) {
        const localInfo = await fetchLocalRightsAndGroups(user.name, homewikiUrl);
        document.getElementById('localGroups').textContent = localInfo.groups.length > 0 ? localInfo.groups.join(', ') : 'None';
        document.getElementById('localRights').textContent = localInfo.rights.length > 0 ? localInfo.rights.join(', ') : 'None';
    } else {
        document.getElementById('localGroups').textContent = 'Not available';
        document.getElementById('localRights').textContent = 'Not available';
    }

    fetchUserImage(user.name);
}

async function fetchLocalRightsAndGroups(username, wikiUrl) {
    const encodedUsername = encodeURIComponent(username);
    try {
        const response = await fetch(`${wikiUrl}/w/api.php?action=query&list=users&ususers=${encodedUsername}&usprop=rights|groups&format=json&origin=*`);
        const data = await response.json();
        const user = data.query.users[0];
        if (user) {
            return {
                rights: user.rights || [],
                groups: user.groups || []
            };
        }
    } catch (e) {
        console.error("Error fetching local rights and groups:", e);
    }
    return { rights: [], groups: [] };
}

async function fetchHomewikiUrl(homeWiki, mergedEntries){
    const match = mergedEntries.find(e => e.wiki === homeWiki);
    return match ? match.url : "Not available";
}

async function fetchUserImage(username){
    const encodedUsername = encodeURIComponent(username);
    try{
        const response = await fetch(`https://meta.wikimedia.org/w/api.php?action=parse&page=User:${encodedUsername}&prop=wikitext&format=json&origin=*`);
        const data = await response.json();
        const wikitext = data.parse.wikitext['*'];
        let imageName = null;

        const templateMatch = wikitext.match(/\| *image name *= *([^\|\}]+)/i);
        if (templateMatch && templateMatch[1]) {
            imageName = templateMatch[1].trim();
        }

        if (!imageName) {
            const fileMatch = wikitext.match(/\[\[File:([^|\]]+)\.(png|jpg|jpeg|gif|svg)/i);
            if (fileMatch && fileMatch[1]) {
                imageName = fileMatch[1].trim() + "." + fileMatch[2].trim();
            }
        }

        if(imageName){
            const imageUrl = `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(imageName)}?width=512`;
            const imgTag = document.createElement('img'); imgTag.src = imageUrl; imgTag.className="user-image";
            document.getElementById('usernameHeader').appendChild(imgTag);
        }
    }catch(e){
        console.log("No image found or API error on Meta-Wiki", e);
    }
}

function calculateAnniversaryData(registrationDate) {
    const regDate = new Date(registrationDate);
    const today = new Date();
    
    let anniversaryThisYear = new Date(regDate);
    anniversaryThisYear.setFullYear(today.getFullYear());

    let yearsCompleted;
    let daysToNext;
    let daysSinceLast;
    
    if (today >= anniversaryThisYear) {
        yearsCompleted = today.getFullYear() - regDate.getFullYear();
        daysSinceLast = Math.floor((today - anniversaryThisYear) / (1000 * 60 * 60 * 24));
        
        let nextAnniversary = new Date(anniversaryThisYear);
        nextAnniversary.setFullYear(today.getFullYear() + 1);
        daysToNext = Math.ceil((nextAnniversary - today) / (1000 * 60 * 60 * 24));
    } else {
        yearsCompleted = today.getFullYear() - regDate.getFullYear() - 1;
        daysToNext = Math.ceil((anniversaryThisYear - today) / (1000 * 60 * 60 * 24));
        daysSinceLast = 0;
    }
    
    const isToday = today.getMonth() === regDate.getMonth() && today.getDate() === regDate.getDate();

    return { daysToNext, yearsCompleted, isToday, daysSinceLast};
}

function displayDaysAndYears(registrationDate) {
    const { daysToNext, yearsCompleted } = calculateAnniversaryData(registrationDate);
    document.getElementById('daysToAnniversary').innerHTML = `<strong>Years of Contribution:</strong> ${yearsCompleted}<br><strong>Days to next Anniversary:</strong> ${daysToNext}`;
}

function showButtons(){
    const wishButton = document.getElementById('wishAnniversaryButton');
    const calendarButton = document.getElementById('addToCalendarButton');
    const { isToday, daysToNext, daysSinceLast } = calculateAnniversaryData(storedUser.registration);
    
    if(storedUser && (isToday || daysToNext <= 10 || (daysSinceLast > 0 && daysSinceLast <= 30))) {
        wishButton.style.display='inline-block';
    } else {
        wishButton.style.display='none';
    }

    if(storedUser) {
        calendarButton.style.display='inline-block';
    } else {
        calendarButton.style.display='none';
    }
}

function getAnniversaryMessage(){
    if (!storedUser) return "";
    const username = storedUser.name;
    const edits = storedUser.editcount;
    const totalEditsFormatted = edits.toLocaleString();
    const { daysToNext, yearsCompleted, isToday, daysSinceLast } = calculateAnniversaryData(storedUser.registration);
    
    let message = "";
    const imageWikitext = `[[File:Rose and Carnation Flower Bouquet 02.png|150px|right|Happy Wiki Anniversary]]`;
    const toolLine = `''Use this [https://suyashdwivedi.github.io/Wiki_Tools/Wiki_Anniversary.html '''Tool'''] to send wiki anniversary wishes to other amazing Wikimedians.''`;

    if (isToday) {
        message = `== Happy Wiki Anniversary 🎉 ==\r\n\r\n${imageWikitext}\r\n\r\nDear [[User:${username}|${username}]],\r\n\r\nWishing you a very happy wiki anniversary today, celebrating '''${yearsCompleted} years''' of invaluable contributions! Your dedication and hard work, reflected in over '''${totalEditsFormatted}''' edits, are a testament to your commitment to the community. Thank you for all you do!\r\n\r\n${toolLine}\r\n\r\n-- ~~~~`;
    } else if(daysToNext > 0 && daysToNext <= 10){
        message = `== Early Wiki Anniversary Wishes 🎉 ==\r\n\r\n${imageWikitext}\r\n\r\nDear [[User:${username}|${username}]],\r\n\r\nYour wiki anniversary is just around the corner, in '''${daysToNext} days!''' What a wonderful milestone of '''${yearsCompleted} years''' on Wiki. Your incredible contributions, with over '''${totalEditsFormatted}''' edits, have truly made a difference. Here's to another amazing year of collaboration and knowledge sharing!\r\n\r\n${toolLine}\r\n\r\n-- ~~~~`;
    } else if(daysSinceLast > 0 && daysSinceLast <= 30) {
        const years = yearsCompleted;
        const daysBelated = daysSinceLast;
        message = `== Belated Wiki Anniversary Wishes 🎉 ==\r\n\r\n${imageWikitext}\r\n\r\nDear  [[User:${username}|${username}]],\r\n\r\nYour wiki anniversary was '''${daysBelated} days''' ago, marking '''${years} years''' of dedicated service! I wanted to extend a heartfelt thanks for your amazing contributions. With over '''${totalEditsFormatted}''' edits, your dedication is an inspiration to the community. Wishing you all the best for the year ahead!\r\n\r\n${toolLine}\r\n\r\n-- ~~~~`;
    } else {
        return "";
    }
    return message;
}

async function handleWishAnniversary(){
    if (!storedUser) {
        alert("Please enter a username and get details first.");
        return;
    }
    const usernameForUrl = storedUser.name.replace(/ /g, '_');
    const message = getAnniversaryMessage();
    
    try {
        await navigator.clipboard.writeText(message);
        const confirmation = document.getElementById('copiedConfirmation');
        confirmation.style.display = 'inline';
        setTimeout(() => confirmation.style.display = 'none', 2000);
    } catch (err) {
        console.error('Failed to copy text: ', err);
    }
    
    const url = `${homewikiUrl}/w/index.php?title=User_talk:${encodeURIComponent(usernameForUrl)}&action=edit&summary=${encodeURIComponent('Wiki Anniversary Wishes')}`;
    window.open(url,'_blank');
}

function displayMessagePreview(){
    const previewDiv = document.getElementById('messagePreview');
    const messageText = document.getElementById('messageText');
    const message = getAnniversaryMessage();
    if (message) {
        messageText.innerText = message;
        previewDiv.style.display = 'block';
    } else {
        previewDiv.style.display = 'none';
    }
}

function handleKeyPress(event){
    if(event.key==='Enter') {
        event.preventDefault();
        getUserDetails();
    }
}

function toggleNightMode() {
    document.body.classList.toggle('night-mode');
}

function addToCalendar() {
    if (!storedUser) return;
    const anniversaryDate = new Date(storedUser.registration);
    const today = new Date();
    const nextAnniversary = new Date(anniversaryDate);
    nextAnniversary.setFullYear(today.getFullYear());
    if (today > nextAnniversary) {
        nextAnniversary.setFullYear(today.getFullYear() + 1);
    }
    const formattedDate = nextAnniversary.toISOString().slice(0, 10).replace(/-/g, '');
    const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
    const eventTitle = `Wiki Anniversary of ${storedUser.name}`;
    const eventDetails = `It's the wiki anniversary of ${storedUser.name} who joined on ${new Date(storedUser.registration).toLocaleDateString('en-US', dateOptions)} and has made ${storedUser.editcount} edits.`;
    const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventTitle)}&dates=${formattedDate}/${formattedDate}&details=${encodeURIComponent(eventDetails)}&sf=true&output=xml`;
    window.open(calendarUrl, '_blank');
}

function goToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

function goToBottom() {
    window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth'
    });
}
</script>
</body>
</html>
